<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–ê–ß–ò –ö–û–†–û ¬∑ –û–Ω–ª–∞–π–Ω —Å –¥—Ä—É–≥–æ–º</title>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            margin: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: #0b3050;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 12px;
        }
        .game-wrapper {
            max-width: 1600px;
            width: 100%;
            background: #1d6390;
            border-radius: 50px;
            padding: 20px;
            border: 6px solid #8eccef;
        }
        .top-panel {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0c4060;
            border-radius: 60px;
            padding: 15px 25px;
            border: 4px solid #9fd3ff;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .dice-area {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .die {
            width: 70px;
            height: 70px;
            background: #edf7ff;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 44px;
            font-weight: 800;
            box-shadow: 0 8px 0 #3c6990;
            color: #00263b;
            border: 3px solid #aad0f5;
        }
        .die.shaking { animation: shake 0.3s ease; }
        @keyframes shake { 25% { transform: rotate(10deg); } 75% { transform: rotate(-10deg); } }
        .roll-btn {
            background: #50b0f0;
            border: none;
            font-size: 32px;
            font-weight: 700;
            padding: 12px 40px;
            border-radius: 60px;
            box-shadow: 0 8px 0 #1d66a0;
            cursor: pointer;
            border: 4px solid #c0e6ff;
        }
        .roll-btn:disabled { opacity: 0.4; transform: translateY(4px); pointer-events: none; }
        .connection-status {
            background: #0b3b50;
            color: white;
            font-size: 22px;
            padding: 8px 20px;
            border-radius: 40px;
            border: 2px solid #7bc4ff;
        }
        .turn-indicator {
            background: #1873a5;
            color: white;
            font-size: 28px;
            font-weight: 700;
            padding: 10px 30px;
            border-radius: 60px;
            border: 3px solid #bbe2ff;
        }
        .main-row {
            display: flex;
            gap: 15px;
            align-items: stretch;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .player-board {
            flex: 1 1 300px;
            background: #156f9f;
            border-radius: 45px;
            padding: 18px;
            border: 5px solid #9fd3ff;
            min-width: 280px;
        }
        .player-header {
            display: flex;
            justify-content: space-between;
            background: #043d5c;
            color: white;
            font-size: 28px;
            font-weight: 700;
            padding: 15px 20px;
            border-radius: 40px;
            border: 3px solid #b0dcff;
            margin-bottom: 15px;
        }
        .coins {
            background: #fad461;
            color: #024059;
            padding: 8px 25px;
            border-radius: 50px;
            font-size: 30px;
        }
        .landmarks-wrap {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        .landmark {
            background: #517e9e;
            border-radius: 30px;
            padding: 12px 5px;
            text-align: center;
            font-size: 18px;
            border: 3px solid #b8dfff;
            opacity: 0.75;
            cursor: pointer;
            color: white;
        }
        .landmark.built {
            opacity: 1;
            background: linear-gradient(145deg, #f5d884, #f0bc40);
            border-color: #ffdb7c;
            color: #1b3d4f;
        }
        .player-enterprises {
            background: #0a547a;
            border-radius: 35px;
            padding: 15px;
            min-height: 150px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .mini-card {
            background: #f2f9ff;
            border-radius: 20px;
            padding: 8px 10px;
            border-left: 10px solid;
            font-size: 18px;
            display: inline-flex;
            gap: 4px;
        }
        .mini-card.green { border-left-color: #2e8b57; }
        .mini-card.blue { border-left-color: #1e6f9f; }
        .mini-card.red { border-left-color: #c13b3b; }
        .mini-card.purple { border-left-color: #9b4faf; }
        .market-grid {
            flex: 2 1 400px;
            background: #10658f;
            border-radius: 50px;
            padding: 20px;
            border: 6px solid #a3d6ff;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            aspect-ratio: 1/1;
            max-width: 550px;
        }
        .market-card {
            background: #eaf5ff;
            border-radius: 25px;
            padding: 10px 5px;
            border-left: 10px solid;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 14px;
            text-align: center;
        }
        .market-card.green { border-left-color: #2e8b57; }
        .market-card.blue { border-left-color: #1e81d0; }
        .card-icon { font-size: 30px; }
        .card-dice { background: #166397; color: white; padding: 3px 8px; border-radius: 20px; font-size: 16px; margin: 4px 0; }
        .card-cost { background: #0b3f5c; color: white; padding: 3px 10px; border-radius: 20px; }
        .buy-btn-market {
            background: #2f8f74;
            border: none;
            color: white;
            font-size: 16px;
            padding: 6px 0;
            border-radius: 30px;
            width: 100%;
            margin-top: 5px;
        }
        .buy-btn-market:disabled { opacity: 0.3; }
        .log-panel {
            background: #094368;
            border-radius: 60px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 5px solid #91cbff;
        }
        .log-text {
            background: #032b40;
            color: #d4f0ff;
            font-size: 22px;
            padding: 12px 30px;
            border-radius: 50px;
            flex: 1;
        }
        .room-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            background: #0b3b50;
            padding: 8px 15px;
            border-radius: 50px;
        }
        .room-input {
            background: white;
            border: none;
            font-size: 18px;
            padding: 8px 12px;
            border-radius: 30px;
            width: 150px;
        }
        .join-btn {
            background: #3ea0dd;
            border: none;
            font-size: 20px;
            padding: 8px 16px;
            border-radius: 40px;
            color: white;
            cursor: pointer;
        }
        @media (max-width: 700px) {
            .market-grid { gap: 8px; padding: 12px; }
            .top-panel { flex-direction: column; }
        }
    </style>
</head>
<body>
<div class="game-wrapper">
    <div class="top-panel">
        <div class="dice-area">
            <div class="die" id="die1">‚öÄ</div>
            <div class="die" id="die2">‚öÄ</div>
            <div class="die" style="width: auto; padding:0 20px;" id="diceSum">2</div>
        </div>
        <button class="roll-btn" id="rollBtn">üé≤ –ë–†–û–°–ò–¢–¨</button>
        <div class="room-controls">
            <input type="text" class="room-input" id="roomInput" placeholder="–∫–æ–º–Ω–∞—Ç–∞" value="machi123">
            <button class="join-btn" id="joinBtn">üîó –í–û–ô–¢–ò</button>
        </div>
        <div class="connection-status" id="status">–ù–µ –≤ —Å–µ—Ç–∏</div>
        <div class="turn-indicator" id="turnDisplay">–•–û–î 1</div>
    </div>

    <div class="main-row">
        <div class="player-board">
            <div class="player-header"><span>üë§ –ò–ì–†–û–ö 1</span><span class="coins" id="p1Coins">3 ü™ô</span></div>
            <div class="landmarks-wrap" id="p1Landmarks"></div>
            <div class="player-enterprises" id="p1Enterprises"></div>
        </div>
        <div class="market-grid" id="marketGrid"></div>
        <div class="player-board">
            <div class="player-header"><span>üë§ –ò–ì–†–û–ö 2</span><span class="coins" id="p2Coins">3 ü™ô</span></div>
            <div class="landmarks-wrap" id="p2Landmarks"></div>
            <div class="player-enterprises" id="p2Enterprises"></div>
        </div>
    </div>

    <div class="log-panel">
        <div class="log-text" id="gameMessage">üéØ –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏ –Ω–∞–∂–º–∏—Ç–µ –í–û–ô–¢–ò</div>
        <button class="join-btn" id="resetGame" style="background:#d6704a;">‚ü≤ –°–ë–†–û–°</button>
    </div>
</div>

<script>
    // ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–≤–æ–∏ –∏–∑ Firebase Console
    const firebaseConfig = {
  apiKey: "AIzaSyBd3A6Wz7NTCfj5bvAbARR2Jw4P5zE4hng",
  authDomain: "machi-d8f62.firebaseapp.com",
  databaseURL: "https://machi-d8f62-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "machi-d8f62",
  storageBucket: "machi-d8f62.firebasestorage.app",
  messagingSenderId: "681603724052",
  appId: "1:681603724052:web:1fdc4b655a657050968801",
  measurementId: "G-5X29V91F2J"
};

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ---------- –ö–ê–†–¢–´ ----------
    const ENTERPRISES = [
        { id: 'wheat', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', dice: [1], cost: 1, income: 1, color: 'green', target: 'any' },
        { id: 'ranch', name: '–†–∞–Ω—á–æ', icon: 'üêÑ', dice: [2], cost: 1, income: 1, color: 'green', target: 'any' },
        { id: 'forest', name: '–õ–µ—Å', icon: 'üå≤', dice: [5], cost: 3, income: 1, color: 'green', target: 'any' },
        { id: 'bakery', name: '–ü–µ–∫–∞—Ä–Ω—è', icon: 'üçû', dice: [2,3], cost: 1, income: 1, color: 'blue', target: 'self' },
        { id: 'convenience', name: '–ú–∞—Ä–∫–µ—Ç', icon: 'üè™', dice: [4], cost: 2, income: 2, color: 'blue', target: 'self' },
        { id: 'cafe', name: '–ö–∞—Ñ–µ', icon: '‚òï', dice: [3], cost: 2, income: 1, color: 'red', target: 'steal' },
        { id: 'familyRest', name: '–†–µ—Å—Ç–æ—Ä–∞–Ω', icon: 'üçù', dice: [3,4], cost: 3, income: 2, color: 'red', target: 'steal' },
        { id: 'stadium', name: '–°—Ç–∞–¥–∏–æ–Ω', icon: 'üèüÔ∏è', dice: [6], cost: 6, income: 2, color: 'purple', target: 'self' },
        { id: 'tvstation', name: '–¢–í-—Å—Ç–∞–Ω—Ü–∏—è', icon: 'üì∫', dice: [6], cost: 7, income: 3, color: 'purple', target: 'self' }
    ];

    const LANDMARKS = [
        { id: 'station', name: '–í–æ–∫–∑–∞–ª', icon: 'üöâ', cost: 4 },
        { id: 'mall', name: '–¢–¶', icon: 'üè¨', cost: 10 },
        { id: 'amusement', name: '–ü–∞—Ä–∫', icon: 'üé°', cost: 16 },
        { id: 'tvTower', name: '–†–∞–¥–∏–æ–≤—ã—à–∫–∞', icon: 'üìª', cost: 22 }
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
        p1: { coins: 3, enterprises: ['wheat','bakery'], landmarks: [] },
        p2: { coins: 3, enterprises: ['wheat','bakery'], landmarks: [] },
        turn: 1,
        diceCount: 1,
        lastRoll: [1,1],
        timestamp: Date.now()
    };

    let marketSupply = {};
    ENTERPRISES.forEach(c => marketSupply[c.id] = 6);

    // –ò–≥—Ä–æ–∫ (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∫–æ–º–Ω–∞—Ç—É)
    let myPlayer = null; // 1 –∏–ª–∏ 2
    let roomId = 'machi123';
    let roomRef = null;

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const die1 = document.getElementById('die1');
    const die2 = document.getElementById('die2');
    const diceSumSpan = document.getElementById('diceSum');
    const rollBtn = document.getElementById('rollBtn');
    const turnDisplay = document.getElementById('turnDisplay');
    const gameMessage = document.getElementById('gameMessage');
    const statusEl = document.getElementById('status');
    const joinBtn = document.getElementById('joinBtn');
    const roomInput = document.getElementById('roomInput');
    const resetBtn = document.getElementById('resetGame');
    const p1Coins = document.getElementById('p1Coins');
    const p2Coins = document.getElementById('p2Coins');
    const p1LandmarksDiv = document.getElementById('p1Landmarks');
    const p2LandmarksDiv = document.getElementById('p2Landmarks');
    const p1EntDiv = document.getElementById('p1Enterprises');
    const p2EntDiv = document.getElementById('p2Enterprises');
    const marketDiv = document.getElementById('marketGrid');

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function getCard(id) { return ENTERPRISES.find(c => c.id === id); }

    function setMessage(msg) { gameMessage.textContent = 'üì£ ' + msg; }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ Firebase
    function pushState() {
        if (roomRef) {
            gameState.timestamp = Date.now();
            roomRef.set(gameState);
        }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–∑ gameState
    function updateUI() {
        p1Coins.textContent = gameState.p1.coins + ' ü™ô';
        p2Coins.textContent = gameState.p2.coins + ' ü™ô';
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
        [ {pid: 'p1', div: p1LandmarksDiv}, {pid: 'p2', div: p2LandmarksDiv} ].forEach(p => {
            let html = '';
            LANDMARKS.forEach(lm => {
                const built = gameState[p.pid].landmarks.includes(lm.id) ? 'built' : '';
                html += `<div class="landmark ${built}" data-landmark="${lm.id}" data-player="${p.pid}">${lm.icon} ${lm.name}<br>${lm.cost}ü™ô</div>`;
            });
            p.div.innerHTML = html;
        });

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –∏–≥—Ä–æ–∫–æ–≤
        [ {pid: 'p1', div: p1EntDiv}, {pid: 'p2', div: p2EntDiv} ].forEach(p => {
            const cnt = {};
            gameState[p.pid].enterprises.forEach(id => cnt[id] = (cnt[id]||0)+1);
            let html = '';
            ENTERPRISES.forEach(c => {
                for(let i=0; i<(cnt[c.id]||0); i++) {
                    html += `<div class="mini-card ${c.color}"><span>${c.icon}</span> ${c.dice.join(',')}</div>`;
                }
            });
            p.div.innerHTML = html || 'üÉè';
        });

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä—ã–Ω–∫–∞
        let marketHtml = '';
        ENTERPRISES.forEach(card => {
            const p1c = gameState.p1.enterprises.filter(id=>id===card.id).length;
            const p2c = gameState.p2.enterprises.filter(id=>id===card.id).length;
            const available = marketSupply[card.id] > 0;
            const canBuy = (myPlayer === gameState.turn) && gameState[`p${gameState.turn}`].coins >= card.cost && available;
            marketHtml += `<div class="market-card ${card.color}">
                <span class="card-icon">${card.icon}</span>
                <span>${card.name}</span>
                <div class="card-dice">${card.dice.join(',')}</div>
                <div class="card-cost">${card.cost}ü™ô</div>
                <div>üßë${p1c} ü§ñ${p2c}</div>
                <button class="buy-btn-market" data-card="${card.id}" ${canBuy ? '' : 'disabled'}>–∫—É–ø–∏—Ç—å</button>
            </div>`;
        });
        marketDiv.innerHTML = marketHtml;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–±–∏–∫–æ–≤
        die1.textContent = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][gameState.lastRoll[0]-1] || '‚öÄ';
        die2.textContent = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][gameState.lastRoll[1]-1] || '‚öÄ';
        diceSumSpan.textContent = gameState.lastRoll[0] + gameState.lastRoll[1];
        turnDisplay.textContent = `–•–û–î ${gameState.turn}`;

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –±—Ä–æ—Å–∫–∞
        if (myPlayer !== gameState.turn) rollBtn.disabled = true;
        else rollBtn.disabled = false;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–∫—É–ø–∫–∞, –ø–æ—Å—Ç—Ä–æ–π–∫–∞)
    function attachHandlers() {
        document.querySelectorAll('.landmark').forEach(el => {
            el.addEventListener('click', () => {
                if (myPlayer !== gameState.turn) { setMessage('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥'); return; }
                const pid = el.dataset.player;
                if (pid !== `p${gameState.turn}`) return;
                const lid = el.dataset.landmark;
                const player = gameState[pid];
                if (player.landmarks.includes(lid)) return;
                const lm = LANDMARKS.find(l => l.id === lid);
                if (player.coins < lm.cost) { setMessage('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç'); return; }
                player.coins -= lm.cost;
                player.landmarks.push(lid);
                setMessage(`–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ: ${lm.name}`);
                pushState();
                updateUI();
            });
        });

        document.querySelectorAll('.buy-btn-market').forEach(btn => {
            btn.addEventListener('click', () => {
                if (myPlayer !== gameState.turn) { setMessage('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥'); return; }
                const cid = btn.dataset.card;
                const card = getCard(cid);
                if (!card) return;
                const player = gameState[`p${gameState.turn}`];
                if (player.coins < card.cost) return;
                if (marketSupply[cid] <= 0) { setMessage('–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'); return; }
                player.coins -= card.cost;
                player.enterprises.push(cid);
                marketSupply[cid]--;
                setMessage(`–ö—É–ø–ª–µ–Ω–æ: ${card.name}`);
                pushState();
                updateUI();
            });
        });
    }

    // –î–æ—Ö–æ–¥
    function resolveIncome(activeNum, diceSum, isDouble) {
        const active = `p${activeNum}`;
        const opp = activeNum===1 ? 'p2' : 'p1';
        function getCards(pid) { return gameState[pid].enterprises.map(id=>getCard(id)).filter(c=>c && c.dice.includes(diceSum)); }
        const redOpp = getCards(opp).filter(c=>c.target==='steal');
        const greenAll = [...getCards(active).filter(c=>c.target==='any'), ...getCards(opp).filter(c=>c.target==='any')];
        const blueSelf = getCards(active).filter(c=>c.target==='self' && c.color==='blue');
        const purpleSelf = getCards(active).filter(c=>c.target==='self' && c.color==='purple');

        redOpp.forEach(c => {
            if (gameState[active].coins >= c.income) {
                gameState[active].coins -= c.income;
                gameState[opp].coins += c.income;
            }
        });
        greenAll.forEach(c => {
            const owner = gameState[active].enterprises.includes(c.id) ? active : opp;
            gameState[owner].coins += c.income;
        });
        blueSelf.forEach(c => gameState[active].coins += c.income);
        purpleSelf.forEach(c => gameState[active].coins += c.income);
        if (isDouble && gameState[active].landmarks.includes('amusement')) gameState[active].coins += 5;
    }

    // –ë—Ä–æ—Å–æ–∫
    function rollDice() {
        if (myPlayer !== gameState.turn) return;
        const d1 = Math.floor(Math.random()*6)+1;
        const d2 = gameState.p1.landmarks.includes('station') ? Math.floor(Math.random()*6)+1 : 0;
        const sum = d2 ? d1+d2 : d1;
        gameState.lastRoll = [d1, d2 || 1];
        resolveIncome(gameState.turn, sum, d1===d2);
        gameState.turn = gameState.turn === 1 ? 2 : 1;
        pushState();
        updateUI();
    }

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
    function joinRoom() {
        roomId = roomInput.value.trim();
        if (!roomId) return;
        statusEl.textContent = 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
        roomRef = database.ref('games/' + roomId);
        
        roomRef.once('value').then(snap => {
            if (!snap.exists()) {
                // –ù–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞, —Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –ò–≥—Ä–æ–∫–æ–º 1
                myPlayer = 1;
                roomRef.set(gameState);
                statusEl.textContent = '‚úÖ –ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞. –í—ã –ò–≥—Ä–æ–∫ 1';
            } else {
                // –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–º–Ω–∞—Ç–∞, —Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –ò–≥—Ä–æ–∫–æ–º 2
                myPlayer = 2;
                statusEl.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –í—ã –ò–≥—Ä–æ–∫ 2';
            }
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
            roomRef.on('value', snap => {
                if (snap.exists()) {
                    gameState = snap.val();
                    marketSupply = {}; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–∏–º–∏—Ç—ã
                    ENTERPRISES.forEach(c => marketSupply[c.id] = 6);
                    updateUI();
                    attachHandlers();
                }
            });
        });
    }

    // –°–±—Ä–æ—Å –∏–≥—Ä—ã
    function resetGame() {
        gameState = {
            p1: { coins: 3, enterprises: ['wheat','bakery'], landmarks: [] },
            p2: { coins: 3, enterprises: ['wheat','bakery'], landmarks: [] },
            turn: 1,
            diceCount: 1,
            lastRoll: [1,1],
            timestamp: Date.now()
        };
        ENTERPRISES.forEach(c => marketSupply[c.id] = 6);
        if (roomRef) roomRef.set(gameState);
        updateUI();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    rollBtn.addEventListener('click', rollDice);
    joinBtn.addEventListener('click', joinRoom);
    resetBtn.addEventListener('click', resetGame);

    // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    updateUI();
    setMessage('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –∏ –Ω–∞–∂–º–∏—Ç–µ –í–û–ô–¢–ò');
</script>
</body>
</html>
