<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–ê–ß–ò –ö–û–†–û ¬∑ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –æ–Ω–ª–∞–π–Ω-–≤–µ—Ä—Å–∏—è</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: #0a2f44;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        .game-container {
            max-width: 1400px;
            width: 100%;
            background: #1e5f88;
            border-radius: 50px;
            padding: 25px;
            border: 6px solid #7fc2f0;
        }
        .top-panel {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0f405c;
            border-radius: 60px;
            padding: 15px 25px;
            border: 4px solid #7fc2f0;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .dice-box {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .die {
            width: 70px;
            height: 70px;
            background: #f5f0e0;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 44px;
            font-weight: bold;
            box-shadow: 0 8px 0 #3d6380;
            color: #1a2e3f;
            border: 3px solid #aad0f5;
        }
        .die.shaking { animation: shake 0.3s ease; }
        @keyframes shake { 25% { transform: rotate(12deg); } 75% { transform: rotate(-12deg); } }
        
        .roll-button {
            background: #54b0f0;
            border: none;
            font-size: 32px;
            font-weight: bold;
            padding: 12px 40px;
            border-radius: 50px;
            box-shadow: 0 8px 0 #1f6390;
            cursor: pointer;
            border: 3px solid #b8e2ff;
            color: #02243b;
            transition: 0.05s linear;
        }
        .roll-button:active { transform: translateY(4px); box-shadow: 0 4px 0 #1f6390; }
        .roll-button:disabled { opacity: 0.4; transform: translateY(4px); pointer-events: none; }
        
        .room-section {
            display: flex;
            gap: 10px;
            background: #0f405c;
            padding: 8px 15px;
            border-radius: 50px;
            border: 2px solid #7fc2f0;
        }
        .room-input {
            background: white;
            border: none;
            font-size: 18px;
            padding: 10px 15px;
            border-radius: 30px;
            width: 150px;
        }
        .join-button {
            background: #3e9ee0;
            border: none;
            font-size: 20px;
            padding: 10px 20px;
            border-radius: 40px;
            color: white;
            cursor: pointer;
            border: 2px solid #b8e2ff;
        }
        .connection-status {
            background: #0f405c;
            color: white;
            font-size: 18px;
            padding: 8px 20px;
            border-radius: 30px;
            border: 2px solid #7fc2f0;
        }
        .turn-display {
            background: #2c7bb0;
            color: white;
            font-size: 26px;
            padding: 10px 25px;
            border-radius: 50px;
            border: 3px solid #b8e2ff;
        }
        
        .game-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .player-board {
            flex: 1 1 300px;
            background: #1976a5;
            border-radius: 40px;
            padding: 20px;
            border: 5px solid #7fc2f0;
        }
        .player-header {
            display: flex;
            justify-content: space-between;
            background: #0b3e58;
            color: white;
            font-size: 28px;
            padding: 15px 20px;
            border-radius: 35px;
            margin-bottom: 15px;
            border: 3px solid #7fc2f0;
        }
        .coin-count {
            background: #ffd966;
            color: #1d4a6e;
            padding: 5px 25px;
            border-radius: 40px;
            font-weight: bold;
        }
        .landmarks-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        .landmark-card {
            background: #4a7b9c;
            border-radius: 25px;
            padding: 12px 5px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            border: 3px solid #b0d8ff;
            opacity: 0.7;
            cursor: pointer;
            color: white;
            box-shadow: 0 5px 0 #2d5575;
            transition: 0.1s;
        }
        .landmark-card.built {
            opacity: 1;
            background: linear-gradient(145deg, #f7d070, #f0b840);
            color: #1d3b4f;
            border-color: #ffdb7c;
            box-shadow: 0 0 15px gold;
        }
        
        .enterprises-area {
            background: #0f5780;
            border-radius: 30px;
            padding: 15px;
            min-height: 120px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            border: 3px solid #7fc2f0;
        }
        .enterprise-token {
            background: #f5f0e0;
            border-radius: 20px;
            padding: 8px 12px;
            border-left: 12px solid;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 0 #5d7a95;
        }
        .enterprise-token.green { border-left-color: #2e8b57; }
        .enterprise-token.blue { border-left-color: #1e6f9f; }
        .enterprise-token.red { border-left-color: #c13b3b; }
        .enterprise-token.purple { border-left-color: #9b4faf; }
        
        .market-square {
            flex: 2 1 400px;
            max-width: 500px;
            background: #0f6490;
            border-radius: 45px;
            padding: 20px;
            border: 6px solid #7fc2f0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            aspect-ratio: 1/1;
        }
        .market-card {
            background: #f5f0e0;
            border-radius: 22px;
            padding: 10px 5px;
            border-left: 12px solid;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 6px 0 #4a6f8a;
        }
        .market-card.green { border-left-color: #2e8b57; }
        .market-card.blue { border-left-color: #1e6f9f; }
        .market-card.red { border-left-color: #c13b3b; }
        .market-card.purple { border-left-color: #9b4faf; }
        .card-icon { font-size: 32px; }
        .card-dice { background: #166397; color: white; padding: 3px 8px; border-radius: 20px; font-size: 14px; margin: 3px 0; }
        .card-cost { background: #0b3f5c; color: white; padding: 3px 10px; border-radius: 20px; }
        .owned-count { font-size: 12px; margin: 2px 0; }
        .buy-button {
            background: #2f8f74;
            border: none;
            color: white;
            font-size: 14px;
            padding: 6px 0;
            border-radius: 30px;
            width: 100%;
            margin-top: 5px;
            cursor: pointer;
            border: 2px solid #7fc2f0;
        }
        .buy-button:disabled { opacity: 0.3; pointer-events: none; }
        
        .log-panel {
            background: #0f405c;
            border-radius: 50px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 4px solid #7fc2f0;
            flex-wrap: wrap;
            gap: 15px;
        }
        .log-message {
            background: #072a3a;
            color: #c7e6ff;
            font-size: 22px;
            padding: 10px 30px;
            border-radius: 40px;
            flex: 1;
        }
        .reset-button {
            background: #d46b4a;
            color: white;
            font-size: 24px;
            padding: 10px 35px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            border: 3px solid #ffb08a;
        }
        .player-identity {
            background: #0f405c;
            color: white;
            font-size: 22px;
            padding: 8px 20px;
            border-radius: 40px;
            border: 2px solid #7fc2f0;
        }
    </style>
</head>
<body>
<div class="game-container">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="top-panel">
        <div class="dice-box">
            <div class="die" id="die1">‚öÄ</div>
            <div class="die" id="die2">‚öÄ</div>
            <div class="die" id="diceSum" style="width: auto; padding:0 20px;">2</div>
        </div>
        <button class="roll-button" id="rollBtn" disabled>üé≤ –ë–†–û–°–û–ö</button>
        <div class="room-section">
            <input type="text" class="room-input" id="roomInput" value="machi2024" placeholder="–∫–æ–º–Ω–∞—Ç–∞">
            <button class="join-button" id="joinBtn">üîó –í–û–ô–¢–ò</button>
        </div>
        <div class="connection-status" id="status">‚ö™ –û—Ç–∫–ª—é—á–µ–Ω</div>
        <div class="player-identity" id="playerIdentity">–í—ã: ‚Äî</div>
        <div class="turn-display" id="turnDisplay">–•–û–î 1</div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
    <div class="game-row">
        <!-- –ò–≥—Ä–æ–∫ 1 -->
        <div class="player-board">
            <div class="player-header">
                <span>üë§ –ò–ì–†–û–ö 1</span>
                <span class="coin-count" id="p1Coins">3ü™ô</span>
            </div>
            <div class="landmarks-grid" id="p1Landmarks"></div>
            <div class="enterprises-area" id="p1Enterprises"></div>
        </div>

        <!-- –û–±—â–∏–π —Ä—ã–Ω–æ–∫ -->
        <div class="market-square" id="marketSquare"></div>

        <!-- –ò–≥—Ä–æ–∫ 2 -->
        <div class="player-board">
            <div class="player-header">
                <span>üë§ –ò–ì–†–û–ö 2</span>
                <span class="coin-count" id="p2Coins">3ü™ô</span>
            </div>
            <div class="landmarks-grid" id="p2Landmarks"></div>
            <div class="enterprises-area" id="p2Enterprises"></div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div class="log-panel">
        <div class="log-message" id="gameMessage">üéØ –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏ –Ω–∞–∂–º–∏—Ç–µ –í–û–ô–¢–ò</div>
        <button class="reset-button" id="resetGame">‚ü≤ –ù–û–í–ê–Ø –ò–ì–†–ê</button>
    </div>
</div>

<script>
    // ‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–û–°–õ–ï –î–ï–ü–õ–û–Ø –°–ï–†–í–ï–†–ê –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –ï–ì–û –ê–î–†–ï–°
    const SERVER_URL = "acceptable-isidora-andnoko-eddbb68b.koyeb.app/"; // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®

    // ==================== –ö–ê–†–¢–´ ====================
    const ENTERPRISES = [
        { id: 'wheat', name: '–ü—à–µ–Ω–∏—Ü–∞', icon: 'üåæ', dice: [1], cost: 1, income: 1, color: 'green', target: 'any' },
        { id: 'ranch', name: '–†–∞–Ω—á–æ', icon: 'üêÑ', dice: [2], cost: 1, income: 1, color: 'green', target: 'any' },
        { id: 'forest', name: '–õ–µ—Å', icon: 'üå≤', dice: [5], cost: 3, income: 1, color: 'green', target: 'any' },
        { id: 'bakery', name: '–ü–µ–∫–∞—Ä–Ω—è', icon: 'üçû', dice: [2,3], cost: 1, income: 1, color: 'blue', target: 'self' },
        { id: 'convenience', name: '–ú–∞—Ä–∫–µ—Ç', icon: 'üè™', dice: [4], cost: 2, income: 2, color: 'blue', target: 'self' },
        { id: 'cafe', name: '–ö–∞—Ñ–µ', icon: '‚òï', dice: [3], cost: 2, income: 1, color: 'red', target: 'steal' },
        { id: 'familyRest', name: '–†–µ—Å—Ç–æ—Ä–∞–Ω', icon: 'üçù', dice: [3,4], cost: 3, income: 2, color: 'red', target: 'steal' },
        { id: 'stadium', name: '–°—Ç–∞–¥–∏–æ–Ω', icon: 'üèüÔ∏è', dice: [6], cost: 6, income: 2, color: 'purple', target: 'self' },
        { id: 'tvstation', name: '–¢–í-—Å—Ç–∞–Ω—Ü–∏—è', icon: 'üì∫', dice: [6], cost: 7, income: 3, color: 'purple', target: 'self' }
    ];

    const LANDMARKS = [
        { id: 'station', name: '–í–æ–∫–∑–∞–ª', icon: 'üöâ', cost: 4 },
        { id: 'mall', name: '–¢–¶', icon: 'üè¨', cost: 10 },
        { id: 'amusement', name: '–ü–∞—Ä–∫', icon: 'üé°', cost: 16 },
        { id: 'tvTower', name: '–†–∞–¥–∏–æ–≤—ã—à–∫–∞', icon: 'üìª', cost: 22 }
    ];

    // ==================== –°–û–°–¢–û–Ø–ù–ò–ï ====================
    const DEFAULT_STATE = {
        p1: { coins: 3, enterprises: ['wheat', 'bakery'], landmarks: [] },
        p2: { coins: 3, enterprises: ['wheat', 'bakery'], landmarks: [] },
        turn: 1,
        lastRoll: [1, 1]
    };

    let gameState = JSON.parse(JSON.stringify(DEFAULT_STATE));
    let marketSupply = {
        wheat: 6, ranch: 6, forest: 6,
        bakery: 6, convenience: 6,
        cafe: 6, familyRest: 6,
        stadium: 6, tvstation: 6
    };
    
    let myPlayer = null;
    let roomId = null;
    let socket = null;

    // ==================== DOM –≠–õ–ï–ú–ï–ù–¢–´ ====================
    const die1 = document.getElementById('die1');
    const die2 = document.getElementById('die2');
    const diceSumSpan = document.getElementById('diceSum');
    const rollBtn = document.getElementById('rollBtn');
    const turnDisplay = document.getElementById('turnDisplay');
    const gameMessage = document.getElementById('gameMessage');
    const statusEl = document.getElementById('status');
    const playerIdentity = document.getElementById('playerIdentity');
    const joinBtn = document.getElementById('joinBtn');
    const roomInput = document.getElementById('roomInput');
    const resetBtn = document.getElementById('resetGame');
    const p1Coins = document.getElementById('p1Coins');
    const p2Coins = document.getElementById('p2Coins');
    const p1LandmarksDiv = document.getElementById('p1Landmarks');
    const p2LandmarksDiv = document.getElementById('p2Landmarks');
    const p1EntDiv = document.getElementById('p1Enterprises');
    const p2EntDiv = document.getElementById('p2Enterprises');
    const marketDiv = document.getElementById('marketSquare');

    // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
    function getCard(id) {
        return ENTERPRISES.find(c => c.id === id) || null;
    }

    function setMessage(msg) {
        gameMessage.textContent = 'üì£ ' + msg;
    }

    // ==================== –û–¢–†–ò–°–û–í–ö–ê ====================
    function updateUI() {
        if (!gameState) return;

        const p1 = gameState.p1 || { coins: 0, enterprises: [], landmarks: [] };
        const p2 = gameState.p2 || { coins: 0, enterprises: [], landmarks: [] };

        p1Coins.textContent = (p1.coins || 0) + 'ü™ô';
        p2Coins.textContent = (p2.coins || 0) + 'ü™ô';

        // –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        renderLandmarks('p1', p1, p1LandmarksDiv);
        renderLandmarks('p2', p2, p2LandmarksDiv);

        // –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
        renderEnterprises('p1', p1, p1EntDiv);
        renderEnterprises('p2', p2, p2EntDiv);

        // –†—ã–Ω–æ–∫
        renderMarket(p1, p2);

        // –ö—É–±–∏–∫–∏
        if (gameState.lastRoll) {
            die1.textContent = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][(gameState.lastRoll[0] || 1) - 1];
            die2.textContent = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][(gameState.lastRoll[1] || 1) - 1];
            diceSumSpan.textContent = (gameState.lastRoll[0] || 1) + (gameState.lastRoll[1] || 1);
        }

        turnDisplay.textContent = `–•–û–î ${gameState.turn || 1}`;
        
        if (myPlayer) {
            playerIdentity.textContent = `–í—ã: –ò–ì–†–û–ö ${myPlayer}`;
            rollBtn.disabled = (myPlayer !== gameState.turn);
        }
    }

    function renderLandmarks(playerId, player, container) {
        let html = '';
        LANDMARKS.forEach(lm => {
            const built = player.landmarks && player.landmarks.includes(lm.id) ? 'built' : '';
            html += `<div class="landmark-card ${built}" data-landmark="${lm.id}" data-player="${playerId}">${lm.icon} ${lm.name}<br>${lm.cost}ü™ô</div>`;
        });
        container.innerHTML = html;
    }

    function renderEnterprises(playerId, player, container) {
        let html = '';
        (player.enterprises || []).forEach(id => {
            const card = getCard(id);
            if (card) {
                html += `<div class="enterprise-token ${card.color}">${card.icon} ${card.dice.join(',')}</div>`;
            }
        });
        container.innerHTML = html || 'üÉè –ù–µ—Ç –∫–∞—Ä—Ç';
    }

    function renderMarket(p1, p2) {
        let html = '';
        ENTERPRISES.forEach(card => {
            const p1c = (p1.enterprises || []).filter(id => id === card.id).length;
            const p2c = (p2.enterprises || []).filter(id => id === card.id).length;
            const available = marketSupply[card.id] > 0;
            const currentPlayer = gameState.turn === 1 ? p1 : p2;
            const canBuy = myPlayer === gameState.turn && 
                          currentPlayer.coins >= card.cost && 
                          available;

            html += `<div class="market-card ${card.color}">
                <span class="card-icon">${card.icon}</span>
                <div class="card-dice">${card.dice.join(',')}</div>
                <div class="card-cost">${card.cost}ü™ô</div>
                <div class="owned-count">üßë ${p1c} / ü§ñ ${p2c}</div>
                <button class="buy-button" data-card="${card.id}" ${canBuy ? '' : 'disabled'}>–∫—É–ø–∏—Ç—å</button>
            </div>`;
        });
        marketDiv.innerHTML = html;
    }

    // ==================== –°–ï–¢–ï–í–´–ï –§–£–ù–ö–¶–ò–ò ====================
    function connectToRoom() {
        roomId = roomInput.value.trim();
        if (!roomId) {
            alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã');
            return;
        }

        statusEl.textContent = 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
        
        try {
            socket = new WebSocket(SERVER_URL);
            
            socket.onopen = () => {
                console.log('WebSocket connected');
                statusEl.textContent = 'üü¢ –í —Å–µ—Ç–∏';
                
                socket.send(JSON.stringify({
                    action: 'join',
                    room: roomId
                }));
            };
            
            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleServerMessage(data);
            };
            
            socket.onerror = (error) => {
                console.error('WebSocket error:', error);
                statusEl.textContent = 'üî¥ –û—à–∏–±–∫–∞';
                setMessage('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É');
            };
            
            socket.onclose = () => {
                statusEl.textContent = '‚ö™ –û—Ç–∫–ª—é—á–µ–Ω';
            };
            
        } catch (e) {
            console.error('Connection error:', e);
            statusEl.textContent = 'üî¥ –û—à–∏–±–∫–∞';
        }
    }

    function handleServerMessage(data) {
        switch(data.type) {
            case 'joined':
                myPlayer = data.player;
                gameState = data.state;
                setMessage(`–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫–∞–∫ –ò–≥—Ä–æ–∫ ${myPlayer}`);
                updateUI();
                attachHandlers();
                break;
                
            case 'gameState':
                gameState = data.state;
                updateUI();
                attachHandlers();
                break;
                
            case 'error':
                alert('–û—à–∏–±–∫–∞: ' + data.message);
                break;
        }
    }

    function sendAction(action, actionData = {}) {
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({
                action: action,
                room: roomId,
                player: myPlayer,
                ...actionData
            }));
        }
    }

    // ==================== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ====================
    function rollDice() {
        if (myPlayer !== gameState.turn) {
            setMessage('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥');
            return;
        }

        const d1 = Math.floor(Math.random() * 6) + 1;
        const d2 = Math.floor(Math.random() * 6) + 1;
        
        sendAction('roll', { dice: [d1, d2] });
    }

    function resolveIncome(activePlayer, diceSum, isDouble) {
        const active = `p${activePlayer}`;
        const opponent = activePlayer === 1 ? 'p2' : 'p1';
        
        const activeEnt = gameState[active]?.enterprises || [];
        const oppEnt = gameState[opponent]?.enterprises || [];

        function getCardsByTarget(pid, targetType) {
            const ents = pid === active ? activeEnt : oppEnt;
            return ents.map(id => getCard(id))
                      .filter(c => c && c.dice.includes(diceSum) && c.target === targetType);
        }

        // –ö—Ä–∞—Å–Ω—ã–µ (–∫—Ä–∞–∂–∞)
        const redOppCards = getCardsByTarget(opponent, 'steal');
        redOppCards.forEach(card => {
            if (gameState[active].coins >= card.income) {
                gameState[active].coins -= card.income;
                gameState[opponent].coins += card.income;
            }
        });

        // –ó–µ–ª–µ–Ω—ã–µ (–ª—é–±–æ–π)
        const greenActive = getCardsByTarget(active, 'any');
        const greenOpp = getCardsByTarget(opponent, 'any');
        greenActive.forEach(card => gameState[active].coins += card.income);
        greenOpp.forEach(card => gameState[opponent].coins += card.income);

        // –°–∏–Ω–∏–µ
        const blueActive = getCardsByTarget(active, 'self').filter(c => c.color === 'blue');
        blueActive.forEach(card => gameState[active].coins += card.income);

        // –§–∏–æ–ª–µ—Ç–æ–≤—ã–µ
        const purpleActive = getCardsByTarget(active, 'self').filter(c => c.color === 'purple');
        purpleActive.forEach(card => gameState[active].coins += card.income);

        // –ü–∞—Ä–∫
        if (isDouble && gameState[active].landmarks.includes('amusement')) {
            gameState[active].coins += 5;
        }
    }

    // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ====================
    function attachHandlers() {
        document.querySelectorAll('.landmark-card').forEach(el => {
            el.onclick = () => {
                if (myPlayer !== gameState.turn) {
                    setMessage('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥');
                    return;
                }
                
                const playerId = el.dataset.player;
                if (playerId !== `p${gameState.turn}`) return;

                const landmarkId = el.dataset.landmark;
                const player = gameState[playerId];
                if (!player) return;

                if (player.landmarks && player.landmarks.includes(landmarkId)) {
                    setMessage('–£–∂–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ');
                    return;
                }

                const landmark = LANDMARKS.find(l => l.id === landmarkId);
                if (!landmark) return;

                if (player.coins < landmark.cost) {
                    setMessage('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç');
                    return;
                }

                sendAction('build', { landmarkId: landmarkId });
            };
        });

        document.querySelectorAll('.buy-button').forEach(btn => {
            btn.onclick = () => {
                if (myPlayer !== gameState.turn) {
                    setMessage('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥');
                    return;
                }

                const cardId = btn.dataset.card;
                const card = getCard(cardId);
                if (!card) return;

                const player = gameState[`p${gameState.turn}`];
                if (!player) return;

                if (player.coins < card.cost) {
                    setMessage('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç');
                    return;
                }

                if (marketSupply[cardId] <= 0) {
                    setMessage('–ö–∞—Ä—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å');
                    return;
                }

                sendAction('buy', { cardId: cardId });
            };
        });
    }

    // ==================== –°–û–ë–´–¢–ò–Ø ====================
    joinBtn.addEventListener('click', connectToRoom);
    
    rollBtn.addEventListener('click', rollDice);
    
    resetBtn.addEventListener('click', () => {
        if (socket && socket.readyState === WebSocket.OPEN) {
            sendAction('reset');
        } else {
            gameState = JSON.parse(JSON.stringify(DEFAULT_STATE));
            marketSupply = {
                wheat: 6, ranch: 6, forest: 6,
                bakery: 6, convenience: 6,
                cafe: 6, familyRest: 6,
                stadium: 6, tvstation: 6
            };
            updateUI();
            setMessage('–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ');
        }
    });

    // –ù–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
    updateUI();
    setMessage('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏ –Ω–∞–∂–º–∏—Ç–µ –í–û–ô–¢–ò');
</script>
</body>
</html>
